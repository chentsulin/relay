<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Relay.GraphQLMutation | Relay Docs</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Relay.GraphQLMutation | Relay Docs"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/relay/index.html"><meta property="og:description" content="A JavaScript framework for building data-driven React applications"><link rel="shortcut icon" href="/relay/img/favicon.png"><link rel="stylesheet" href="/relay/css/relay.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/relay/"><img class="nav-logo" src="/relay/img/logo.svg" width="50" height="50">Relay</a><ul class="nav-site"><li><a href="/relay/prototyping/playground.html" class="">Try it out</a></li><li><a href="/relay/docs/getting-started.html#content" class="active">Docs</a></li><li><a href="/relay/support.html" class="">Support</a></li><li><a href="https://github.com/facebook/relay" class="">GitHub</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/getting-started.html#content">Getting Started</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/tutorial.html#content">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-graphql.html#content">Thinking in GraphQL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-relay.html#content">Thinking In Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/videos.html#content">Videos</a></li></ul></div><div class="nav-docs-section"><h3>Guides</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/guides-containers.html#content">Containers</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-routes.html#content">Routes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-root-container.html#content">Root Container</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-ready-state.html#content">Ready State</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-mutations.html#content">Mutations</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-network-layer.html#content">Network Layer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-babel-plugin.html#content">Babel Relay Plugin</a></li></ul></div><div class="nav-docs-section"><h3>GraphQL</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-relay-specification.html#content">GraphQL Relay Specification</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-object-identification.html#content">Object Identification</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-connections.html#content">Connection</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-mutations.html#content">Mutations</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-further-reading.html#content">Further Reading</a></li></ul></div><div class="nav-docs-section"><h3>API Reference</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay.html#content">Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-container.html#content">RelayContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-route.html#content">Relay.Route</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-renderer.html#content">Relay.Renderer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-root-container.html#content">Relay.RootContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-ql.html#content">Relay.QL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-mutation.html#content">Relay.Mutation</a></li><li><a style="margin-left:0;" class="active" href="/relay/docs/api-reference-relay-graphql-mutation.html#content">Relay.GraphQLMutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-proptypes.html#content">Relay.PropTypes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-store.html#content">Relay.Store</a></li></ul></div><div class="nav-docs-section"><h3>Interfaces</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-network-layer.html#content">RelayNetworkLayer</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/interfaces-relay-mutation-request.html#content">RelayMutationRequest</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/interfaces-relay-query-request.html#content">RelayQueryRequest</a></li></ul></div></div><div class="inner-content"><a id="content"></a><a class="edit-page-link" href="https://github.com/facebook/relay/blob/master/docs/APIReference-GraphQLMutation.md" target="_blank">Edit on GitHub</a><h1>Relay.GraphQLMutation</h1><div><p><code>Relay.GraphQLMutation</code> 是一個用來塑造 GraphQL mutation 的低階 API。</p><p>這是在 Relay 中，產品程式碼可以用來處理 mutation 的最低階抽象概念，它對應到描述在 <a href="../graphql/mutations.htm" target="_blank">GraphQL Specification</a> 的 mutation 操作 (「一個寫入並伴隨著一個查詢」)。你需要指定 mutation、input 以及 query。</p><p><code>Relay.GraphQLMutation</code> 沒有提供特殊的功能，例如 fat queries 或是 tracked queries (就是要被送到伺服器的 mutation query 的執行期自動合成)，而是讓使用者定義一個靜態且明確的 query。限制你自己使用這個低階 API 是個有用的前置步驟，將可以幫你的程式碼庫準備好遷移到新的靜態 Relay 核心。同時，如果你想要這些動態的功能，可以採用高階的 <code>Relay.Mutation</code> API。</p><h2><a class="anchor" name=""></a>概觀 <a class="hash-link" href="#">#</a></h2><p><em>屬性</em></p><div><ul class="apiIndex">
  <li>
    <a href="#create-static-method">
      <pre>static create(mutation, variables, environment)</pre>
      建立一個 static mutation
    </a>
  </li>
  <li>
    <a href="#createwithfiles-static-method">
      <pre>static createWithFiles(mutation, variables, files, environment)</pre>
      建立一個接受「files」物件的 static mutation
    </a>
  </li>
</ul>

</div><p><em>方法</em></p><div><ul class="apiIndex">
  <li>
    <a href="#constructor">
      <pre>constructor(query, variables, files, environment, callbacks, collisionKey)</pre>
    </a>
  </li>
  <li>
    <a href="#applyoptimistic">
      <pre>applyOptimistic(optimisticQuery, optimisticResponse, configs)</pre>
    </a>
  </li>
  <li>
    <a href="#commit">
      <pre>commit(configs)</pre>
    </a>
  </li>
  <li>
    <a href="#rollback">
      <pre>rollback()</pre>
    </a>
  </li>
</ul>

</div><h2><a class="anchor" name=""></a>屬性 <a class="hash-link" href="#">#</a></h2><h3><a class="anchor" name="create-static"></a>create (static 方法) <a class="hash-link" href="#create-static">#</a></h3><pre class="prism language-javascript">
<span class="token keyword">static</span> <span class="token function">create</span><span class="token punctuation">(</span>
  mutation<span class="token punctuation">:</span> RelayConcreteNode<span class="token punctuation">,</span>
  variables<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
  environment<span class="token punctuation">:</span> RelayEnvironmentInterface
<span class="token punctuation">)</span><span class="token punctuation">:</span> RelayGraphQLMutation<span class="token punctuation">;</span></pre><p>包裝了 constructor 的便利方法，傳遞一些預設的參數並回傳一個實體。</p><h4><a class="anchor" name="create-static"></a>範例 <a class="hash-link" href="#create-static">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">const</span> environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Relay<span class="token punctuation">.</span>Environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> query <span class="token operator">=</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`mutation FeedbackLikeMutation {
  feedbackLike(input: $input) {
    clientMutationId
    feedback {
      doesViewerLike
    }
  }
}`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> variables <span class="token operator">=</span> <span class="token punctuation">{</span>
  input<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    feedbackId<span class="token punctuation">:</span> <span class="token string">&#x27;aFeedbackId&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mutation <span class="token operator">=</span> RelayGraphQLMutation<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
  query<span class="token punctuation">,</span>
  variables<span class="token punctuation">,</span>
  environment
<span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:300px;"></div><div class="line-highlight" style="height:20px;top:320px;"></div><div class="line-highlight" style="height:20px;top:340px;"></div><div class="line-highlight" style="height:20px;top:360px;"></div><div class="line-highlight" style="height:20px;top:380px;"></div></pre><p>參閱：<a href="#constructor" target="">GraphQLMutation &gt; Constructor</a></p><h3><a class="anchor" name="createwithfiles-static"></a>createWithFiles (static 方法) <a class="hash-link" href="#createwithfiles-static">#</a></h3><p>包裝了 constructor 的便利方法，傳遞一些預設的參數並回傳一個實體。</p><pre class="prism language-javascript">
<span class="token keyword">static</span> <span class="token function">createWithFiles</span><span class="token punctuation">(</span>
  mutation<span class="token punctuation">:</span> RelayConcreteNode<span class="token punctuation">,</span>
  variables<span class="token punctuation">:</span> Variables<span class="token punctuation">,</span>
  files<span class="token punctuation">:</span> FileMap<span class="token punctuation">,</span>
  environment<span class="token punctuation">:</span> RelayEnvironmentInterface
<span class="token punctuation">)</span><span class="token punctuation">:</span> RelayGraphQLMutation<span class="token punctuation">;</span></pre><h4><a class="anchor" name="createwithfiles-static"></a>範例 <a class="hash-link" href="#createwithfiles-static">#</a></h4><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// 給定一個這樣的 `files` 物件：</span>
<span spellcheck="true" class="token comment">//</span>
<span spellcheck="true" class="token comment">//   type FileMap = {[key: string]: File};</span>
<span spellcheck="true" class="token comment">//</span>
<span spellcheck="true" class="token comment">// 還有在前面範例中的</span>
<span spellcheck="true" class="token comment">// `query`, `variables` 以及 `environment` 參數：</span>
<span class="token keyword">const</span> mutation <span class="token operator">=</span> RelayGraphQLMutation<span class="token punctuation">.</span><span class="token function">createWithFiles</span><span class="token punctuation">(</span>
  query<span class="token punctuation">,</span>
  variables<span class="token punctuation">,</span>
  files<span class="token punctuation">,</span>
  environment
<span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:120px;"></div><div class="line-highlight" style="height:20px;top:140px;"></div><div class="line-highlight" style="height:20px;top:160px;"></div><div class="line-highlight" style="height:20px;top:180px;"></div><div class="line-highlight" style="height:20px;top:200px;"></div></pre><p>參閱：<a href="#constructor" target="">GraphQLMutation &gt; Constructor</a></p><h2><a class="anchor" name=""></a>方法 <a class="hash-link" href="#">#</a></h2><h3><a class="anchor" name="constructor"></a>constructor <a class="hash-link" href="#constructor">#</a></h3><pre class="prism language-javascript">
<span class="token function">constructor</span><span class="token punctuation">(</span>
  query<span class="token punctuation">:</span> RelayConcreteNode<span class="token punctuation">,</span>
  variables<span class="token punctuation">:</span> Variables<span class="token punctuation">,</span>
  files<span class="token punctuation">:</span> <span class="token operator">?</span>FileMap<span class="token punctuation">,</span>
  environment<span class="token punctuation">:</span> RelayEnvironmentInterface<span class="token punctuation">,</span>
  callbacks<span class="token punctuation">:</span> <span class="token operator">?</span>RelayMutationTransactionCommitCallbacks<span class="token punctuation">,</span>
  collisionKey<span class="token punctuation">:</span> <span class="token operator">?</span>string
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>這是用可選擇的 <code>files</code>、<code>callbacks</code> 和 <code>collisionKey</code> 參數來建立 <code>Relay.GraphQLMutation</code> 實體的一般 constructor。</p><p>呼叫者必須提供一個適當的 <code>query</code> 以及 <code>variables</code>。參照 GraphQL Relay Specification：</p><ul><li>mutation 應該接收命名叫做「input」的單一參數。</li><li>該 input 參數應該包含一個「clientMutationId」(字串) 屬性用於協調請求和回應的用途 (會自動被 <code>Relay.GraphQLMutation</code> API 添加)。</li><li>query 應該請求「clientMutationId」當作一個選擇的屬性。</li></ul><p>如果沒有提供，會產生一個唯一的 collision key (意味著建立的 mutation 會是獨立的而且不會與其他的碰撞)。</p><h4><a class="anchor" name="constructor"></a>範例 <a class="hash-link" href="#constructor">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">const</span> collisionKey <span class="token operator">=</span> <span class="token string">&#x27;feedback-like: &#x27;</span> <span class="token operator">+</span> variables<span class="token punctuation">.</span>input<span class="token punctuation">.</span>feedbackId<span class="token punctuation">;</span>
<span class="token keyword">const</span> mutation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RelayGraphQLMutation</span><span class="token punctuation">(</span>
  query<span class="token punctuation">,</span>
  variables<span class="token punctuation">,</span>
  <span class="token keyword">null</span><span class="token punctuation">,</span> <span spellcheck="true" class="token comment">// 沒有檔案。</span>
  environment<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    onFailure<span class="token punctuation">:</span> err <span class="token operator">=</span><span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span>
    onSuccess<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Success!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  collisionKey
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>參閱：<a href="api-reference-relay-mutation.html#getcollisionkey" target="_blank">Relay.Mutation::getCollisionKey()</a></p><h3><a class="anchor" name="applyoptimistic"></a>applyOptimistic <a class="hash-link" href="#applyoptimistic">#</a></h3><pre class="prism language-javascript">
<span class="token function">applyOptimistic</span><span class="token punctuation">(</span>
  optimisticQuery<span class="token punctuation">:</span> RelayConcreteNode<span class="token punctuation">,</span>
  optimisticResponse<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
  configs<span class="token punctuation">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>RelayMutationConfig<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> RelayMutationTransaction<span class="token punctuation">;</span></pre><p>呼叫這個來樂觀地套用一個更新到 store。</p><p>選擇性傳遞的 <code>config</code> 參數可以用來設定一個 <code>RANGE_ADD</code> 或其他類型的 mutation，可參照 <code>Relay.Mutation</code> API。這會告訴 Relay 要如何處理回應。</p><p>可選擇性地，在後面呼叫 <code>commit()</code> 來送 mutation 到伺服器。</p><p><strong>附註：</strong>一個 optimistic 更新只可以套用一次。</p><h4><a class="anchor" name="applyoptimistic"></a>範例 <a class="hash-link" href="#applyoptimistic">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">const</span> optimisticQuery <span class="token operator">=</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`mutation FeedbackLikeOptimisticUpdate {
  feedbackLike(input: $input) {
    clientMutationId
    feedback {
      doesViewerLike
      id
    }
  }
}`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> optimisticResponse <span class="token operator">=</span> <span class="token punctuation">{</span>
  feedback<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    doesViewerLike<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token string">&#x27;aFeedbackId&#x27;</span><span class="token punctuation">,</span>
    __typename<span class="token punctuation">:</span> <span class="token string">&#x27;Feedback&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> transaction <span class="token operator">=</span> mutation<span class="token punctuation">.</span><span class="token function">applyOptimistic</span><span class="token punctuation">(</span>
  optimisticQuery<span class="token punctuation">,</span>
  optimisticResponse<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:340px;"></div><div class="line-highlight" style="height:20px;top:360px;"></div><div class="line-highlight" style="height:20px;top:380px;"></div><div class="line-highlight" style="height:20px;top:400px;"></div></pre><p>參閱：<a href="api-reference-relay-mutation.html#getconfigs-abstract-method" target="_blank">Relay.Mutation::getConfigs()</a></p><h3><a class="anchor" name="commit"></a>commit <a class="hash-link" href="#commit">#</a></h3><pre class="prism language-javascript">
<span class="token function">commit</span><span class="token punctuation">(</span>configs<span class="token punctuation">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>RelayMutationConfig<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> RelayMutationTransaction<span class="token punctuation">;</span></pre><p>呼叫這個來送 mutation 到伺服器。</p><p>選擇性傳遞的 <code>config</code> 參數可以用來設定一個 <code>RANGE_ADD</code> 或其他類型的 mutation，類似於 <code>Relay.Mutation</code> API。</p><p>可選擇性地，在前面呼叫 <code>applyOptimistic()</code> 來樂觀地套用更新到 store。</p><p>附註：這個方法每個實體只可以呼叫一次。</p><h4><a class="anchor" name="commit"></a>範例 <a class="hash-link" href="#commit">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">const</span> configs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">&#x27;RANGE_ADD&#x27;</span><span class="token punctuation">,</span>
  connectionName<span class="token punctuation">:</span> <span class="token string">&#x27;topLevelComments&#x27;</span><span class="token punctuation">,</span>
  edgeName<span class="token punctuation">:</span> <span class="token string">&#x27;feedbackCommentEdge&#x27;</span><span class="token punctuation">,</span>
  parentID<span class="token punctuation">:</span> <span class="token string">&#x27;aFeedbackId&#x27;</span><span class="token punctuation">,</span>
  parentName<span class="token punctuation">:</span> <span class="token string">&#x27;feedback&#x27;</span><span class="token punctuation">,</span>
  rangeBehaviors<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&#x27;&#x27;</span><span class="token punctuation">:</span> GraphQLMutatorConstants<span class="token punctuation">.</span>PREPEND<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> transaction <span class="token operator">=</span> mutation<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:200px;"></div></pre><p>參閱：<a href="api-reference-relay-mutation.html#getconfigs-abstract-method" target="_blank">Relay.Mutation::getConfigs()</a></p><h3><a class="anchor" name="rollback"></a>rollback <a class="hash-link" href="#rollback">#</a></h3><pre class="prism language-javascript">
<span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span></pre><p>復原一個 optimistic mutation。</p><h2><a class="anchor" name=""></a>參閱 <a class="hash-link" href="#">#</a></h2><p>可以<a href="https://github.com/facebook/relay/blob/master/src/mutation/__tests__/RelayGraphQLMutation-test.js" target="_blank">在測試組中</a>找到更多詳細的用法範例。</p></div><div class="docs-prevnext"><a class="docs-next" href="api-reference-relay-proptypes.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">©2016 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
              ga('create', 'UA-71174216-1', 'auto');
              ga('send', 'pageview');
          </script></body></html>