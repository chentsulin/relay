<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>RelayContainer | Relay Docs</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="RelayContainer | Relay Docs"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/relay/index.html"><meta property="og:description" content="A JavaScript framework for building data-driven React applications"><link rel="shortcut icon" href="/relay/img/favicon.png"><link rel="stylesheet" href="/relay/css/relay.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/relay/"><img class="nav-logo" src="/relay/img/logo.svg" width="50" height="50">Relay</a><ul class="nav-site"><li><a href="/relay/prototyping/playground.html" class="">Try it out</a></li><li><a href="/relay/docs/getting-started.html#content" class="active">Docs</a></li><li><a href="/relay/support.html" class="">Support</a></li><li><a href="https://github.com/facebook/relay" class="">GitHub</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/getting-started.html#content">Getting Started</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/tutorial.html#content">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-graphql.html#content">Thinking in GraphQL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-relay.html#content">Thinking In Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/videos.html#content">Videos</a></li></ul></div><div class="nav-docs-section"><h3>Guides</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/guides-containers.html#content">Containers</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-routes.html#content">Routes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-root-container.html#content">Root Container</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-ready-state.html#content">Ready State</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-mutations.html#content">Mutations</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-network-layer.html#content">Network Layer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-babel-plugin.html#content">Babel Relay Plugin</a></li></ul></div><div class="nav-docs-section"><h3>GraphQL</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-relay-specification.html#content">GraphQL Relay Specification</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-object-identification.html#content">Object Identification</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-connections.html#content">Connection</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-mutations.html#content">Mutations</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-further-reading.html#content">Further Reading</a></li></ul></div><div class="nav-docs-section"><h3>API Reference</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay.html#content">Relay</a></li><li><a style="margin-left:0;" class="active" href="/relay/docs/api-reference-relay-container.html#content">RelayContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-route.html#content">Relay.Route</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-renderer.html#content">Relay.Renderer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-root-container.html#content">Relay.RootContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-ql.html#content">Relay.QL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-mutation.html#content">Relay.Mutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-graphql-mutation.html#content">Relay.GraphQLMutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-proptypes.html#content">Relay.PropTypes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-store.html#content">Relay.Store</a></li></ul></div><div class="nav-docs-section"><h3>Interfaces</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-network-layer.html#content">RelayNetworkLayer</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/interfaces-relay-mutation-request.html#content">RelayMutationRequest</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/interfaces-relay-query-request.html#content">RelayQueryRequest</a></li></ul></div></div><div class="inner-content"><a id="content"></a><a class="edit-page-link" href="https://github.com/facebook/relay/blob/master/docs/APIReference-Container.md" target="_blank">Edit on GitHub</a><h1>RelayContainer</h1><div><p><code>RelayContainer</code> 是一個 higher-order React component，讓一個 React component 編碼它的資料需求。</p><ul><li>Relay 確保 component 在被 render 之前，資料是可以取用的。</li><li>每當底層資料改變時，Relay 會更新 component。</li></ul><p>Relay container 是使用 <code>Relay.createContainer</code> 來建立的。</p><h2><a class="anchor" name=""></a>概觀 <a class="hash-link" href="#">#</a></h2><p><em>Container 規格</em></p><div><ul class="apiIndex">
  <li>
    <a href="#fragments">
      <pre>fragments</pre>
      使用 fragments 來宣告 component 的資料需求。
    </a>
  </li>
  <li>
    <a href="#initialvariables">
      <pre>initialVariables</pre>
      這個 component 的 fragments 可以使用的一組初始變數值。
    </a>
  </li>
  <li>
    <a href="#preparevariables">
      <pre>prepareVariables</pre>
      一個可以基於執行環境或先前變數的值來調整變數的方法。
    </a>
  </li>
  <li>
    <a href="#shouldcomponentupdate">
      <pre>shouldComponentUpdate</pre>
      可選擇性地覆寫掉 RelayContainer 的預設 `shouldComponentUpdate` 實作。
    </a>
  </li>
</ul>

</div><p><em>屬性和方法</em></p><p>在一般的 React component 中，container 將會提供一些方法和屬性做為 <code>this.props.relay</code>。</p><div><ul class="apiIndex">
  <li>
    <a href="#route">
      <pre>route</pre>
    </a>
  </li>
  <li>
    <a href="#pendingvariables">
      <pre>pendingVariables </pre>
    </a>
  </li>
  <li>
    <a href="#variables">
      <pre>variables</pre>
    </a>
  </li>
  <li>
    <a href="#setvariables">
      <pre>setVariables([partialVariables[, onReadyStateChange]])</pre>
    </a>
  </li>
  <li>
    <a href="#forcefetch">
      <pre>forceFetch([partialVariables[, onReadyStateChange]]) </pre>
    </a>
  </li>
  <li>
    <a href="#hasoptimisticupdate">
      <pre>hasOptimisticUpdate(record)</pre>
    </a>
  </li>
  <li>
    <a href="#getpendingtransactions">
      <pre>getPendingTransactions(record) </pre>
    </a>
  </li>
</ul>

</div><p><em>Static 方法</em></p><div><ul class="apiIndex">
  <li>
    <a href="#getfragment">
      <pre>getFragment(name[, vars])</pre>
      在 parent fragment 中取得一個包含 container fragment 的 reference。
    </a>
  </li>
</ul>

</div><h2><a class="anchor" name="container"></a>Container 規格 <a class="hash-link" href="#container">#</a></h2><h3><a class="anchor" name="fragments"></a>fragments <a class="hash-link" href="#fragments">#</a></h3><pre class="prism language-javascript">
fragments<span class="token punctuation">:</span> RelayQueryFragments<span class="token operator">&lt;</span>Tk<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>propName<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
    variables<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span>
  <span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`fragment on ...`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>Container 使用 GraphQL fragments 來在 <code>fragments</code> 宣告資料的需求。</p><p>當 component 被 render 時，只有透過這些 fragments 指定的欄位，會被填入 <code>this.props</code>。這可以確保一個 component 從在它的父 component 或其他任何的子 component 沒有隱式的依賴關係。</p><h4><a class="anchor" name="fragments"></a>範例 <a class="hash-link" href="#fragments">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">StarWarsShip</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>ship<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>StarWarsShip<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    ship<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`
      fragment on Ship {
        name
      }
    `</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:140px;"></div><div class="line-highlight" style="height:20px;top:160px;"></div><div class="line-highlight" style="height:20px;top:180px;"></div><div class="line-highlight" style="height:20px;top:200px;"></div><div class="line-highlight" style="height:20px;top:220px;"></div><div class="line-highlight" style="height:20px;top:240px;"></div><div class="line-highlight" style="height:20px;top:260px;"></div></pre><p>在這個範例中，這個與 <code>ship</code> fragment 關聯的欄位，可以在 <code>this.props.ship</code> 上使用。</p><p>也可以參閱：<a href="guides-containers.html#relay-containers" target="_blank">Containers &gt; Relay Containers</a></p><h3><a class="anchor" name="initialvariables"></a>initialVariables <a class="hash-link" href="#initialvariables">#</a></h3><pre class="prism language-javascript">
initialVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>這個 component 的 fragments 可以使用的一組初始變數值。</p><h4><a class="anchor" name="initialvariables"></a>範例 <a class="hash-link" href="#initialvariables">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">ProfilePicture</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>ProfilePicture<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  initialVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span>size<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL`
      # 在這裡可以用 <span class="token string">&#x27;$size&#x27;</span> 取用上面定義的變數。
      # 在這裡參考的任何變數都需要被定義在上面的 initalVariables。
      # 一個 <span class="token string">&#x27;undefined&#x27;</span> 的變數值會拋出一個 <span class="token string">&#x27;Invariant Violation&#x27;</span> 的例外。
      # 使用 <span class="token string">&#x27;null&#x27;</span> 來初始化未知的值。
      fragment on User <span class="token punctuation">{</span> <span class="token function">profilePicture</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span> $size<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    `<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:60px;"></div></pre><p>在這個範例中，會在初始 render 時，抓取 <code>profilePicture(size: 50)</code>。</p><h3><a class="anchor" name="preparevariables"></a>prepareVariables <a class="hash-link" href="#preparevariables">#</a></h3><pre class="prism language-javascript">
prepareVariables<span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">(</span>
  prevVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span>
<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span></pre><p>Container 可以定義一個 <code>prepareVariables</code> 方法，提供機會來調整 fragments 可以取用的變數。基於先前的變數（或如果先前的變數不存在的話， <code>initalVariables</code>）以及 runtime 環境，來產生新的變數。</p><p>這個方法也會在從 <code>setVariables</code> 來的一組變數被套用後被呼叫。回傳的變數會被填入到 fragments。</p><h4><a class="anchor" name="preparevariables"></a>範例 <a class="hash-link" href="#preparevariables">#</a></h4><pre class="prism language-javascript">
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>ProfilePicture<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  initialVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span>size<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  prepareVariables<span class="token punctuation">:</span> prevVariables <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>prevVariables<span class="token punctuation">,</span>
      <span spellcheck="true" class="token comment">// 如果 devicePixelRatio 是 `2`，新的 size 會為 `100`。</span>
      size<span class="token punctuation">:</span> prevVariables<span class="token punctuation">.</span>size <span class="token operator">*</span> window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span spellcheck="true" class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:40px;"></div><div class="line-highlight" style="height:20px;top:60px;"></div><div class="line-highlight" style="height:20px;top:80px;"></div><div class="line-highlight" style="height:20px;top:100px;"></div><div class="line-highlight" style="height:20px;top:120px;"></div><div class="line-highlight" style="height:20px;top:140px;"></div><div class="line-highlight" style="height:20px;top:160px;"></div></pre><h3><a class="anchor" name="shouldcomponentupdate"></a>shouldComponentUpdate <a class="hash-link" href="#shouldcomponentupdate">#</a></h3><pre class="prism language-javascript">
shouldComponentUpdate<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> boolean<span class="token punctuation">;</span></pre><p>RelayContainer 實做了一個傳統的預設 <code>shouldComponentUpdate</code>，在 fragment props 沒有改變而且所有其他的 props 都是相等的值時會回傳 <code>false</code>。這可能會阻擋藉由 context 接收資料的  component 的更新。為了確保在這個狀況能進行更新，可以透過指定一個 <code>shouldComponentUpdate</code> function 覆寫預設的行為。</p><h4><a class="anchor" name="shouldcomponentupdate"></a>範例 <a class="hash-link" href="#shouldcomponentupdate">#</a></h4><pre class="prism language-javascript">
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>ProfilePicture<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  shouldComponentUpdate<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
  <span spellcheck="true" class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:20px;"></div></pre><h2><a class="anchor" name=""></a>屬性和方法 <a class="hash-link" href="#">#</a></h2><p>從被包覆的 React component 可以在 <code>this.props.relay</code> 存取列在下方的屬性和方法。</p><h3><a class="anchor" name="route"></a>route <a class="hash-link" href="#route">#</a></h3><pre class="prism language-javascript">
route<span class="token punctuation">:</span> RelayRoute</pre><p>當一個 component 在被 render 時，Route 提供的 context 是非常有用的。它包含當下的 route 有關 <code>name</code>、<code>params</code>、和 <code>queries</code> 的資訊。</p><h4><a class="anchor" name="route"></a>範例 <a class="hash-link" href="#route">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>relay<span class="token punctuation">.</span>route<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">&#x27;SuperAwesomeRoute&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span spellcheck="true" class="token comment">// 做了一些很酷的東西。</span>
<span class="token punctuation">}</span></pre><p>也可以參閱：<a href="guides-routes.html" target="_blank">Routes</a></p><h3><a class="anchor" name="variables"></a>variables <a class="hash-link" href="#variables">#</a></h3><pre class="prism language-javascript">
variables<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span></pre><p><code>variables</code> 包含了一組變數，被用來抓取當下的一組 props。</p><h4><a class="anchor" name="variables"></a>範例 <a class="hash-link" href="#variables">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">ProfilePicture</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>View<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Image
          uri<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>profilePicture<span class="token punctuation">.</span>uri<span class="token punctuation">}</span>
          width<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>relay<span class="token punctuation">.</span>variables<span class="token punctuation">.</span>size<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>ProfilePicture<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  initialVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span>size<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`
      fragment on User { profilePicture(size: $size) { ... } }
    `</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:140px;"></div></pre><p>在這個範例中，被 render 的圖片 <code>width</code> 會對應到被用來抓取目前 <code>profilePicture.uri</code> 版本所使用的 <code>$size</code> 變數。</p><blockquote><p>附註</p><p>永遠不要直接改動 <code>this.props.relay.variables</code>，它不會正確的觸發抓取資料。把 <code>this.props.relay.variables</code> 當作是 immutable 的來處理，就像 props 一樣。</p></blockquote><h3><a class="anchor" name="pendingvariables"></a>pendingVariables <a class="hash-link" href="#pendingvariables">#</a></h3><pre class="prism language-javascript">
pendingVariables<span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span></pre><p><code>pendingVariables</code> contains the set of variables that are being used to fetch the new props, i.e. when <code>this.props.relay.setVariables()</code> or <code>this.props.relay.forceFetch()</code> are called and the corresponding request is in flight.</p><p>If no request is in flight pendingVariables is <code>null</code>.</p><h4><a class="anchor" name="pendingvariables-example"></a>Example <a class="hash-link" href="#pendingvariables-example">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">ProfilePicture</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  requestRandomPictureSize <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> randIntMin <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> randIntMax <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>randIntMax <span class="token operator">-</span> randIntMin <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> randIntMin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>relay<span class="token punctuation">.</span><span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token punctuation">{</span>size<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>relay<span class="token punctuation">,</span> user<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>pendingVariables<span class="token punctuation">}</span> <span class="token operator">=</span> relay<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pendingVariables <span class="token operator">&amp;&amp;</span> <span class="token string">&#x27;size&#x27;</span> <span class="token keyword">in</span> pendingVariables<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span spellcheck="true" class="token comment">// Profile picture with new size is loading</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>View<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>LoadingSpinner <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>View<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Image
          uri<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>profilePicture<span class="token punctuation">.</span>uri<span class="token punctuation">}</span>
          width<span class="token operator">=</span><span class="token punctuation">{</span>relay<span class="token punctuation">.</span>variables<span class="token punctuation">.</span>size<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>requestRandomPictureSize<span class="token punctuation">}</span><span class="token operator">&gt;</span>
          Request random picture size
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>View<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>ProfilePicture<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  initialVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span>size<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    user<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`
      fragment on User { profilePicture(size: $size) { ... } }
    `</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:220px;"></div></pre><p>In this example, whenever a picture with a new size is being loaded a spinner is displayed instead of the picture.</p><h3><a class="anchor" name="setvariables"></a>setVariables <a class="hash-link" href="#setvariables">#</a></h3><pre class="prism language-javascript">
<span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token punctuation">[</span>partialVariables<span class="token punctuation">:</span> Object<span class="token punctuation">,</span> <span class="token punctuation">[</span>onReadyStateChange<span class="token punctuation">:</span> Function<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span></pre><p>Component 可以透過使用 <code>setVariables</code> 要求更新目前的 <code>variables</code> 組合，來改變它們的資料需求。</p><p>可以在同時呼叫 <code>this.props.relay.setVariables</code> 更新所有變數或是它的一個子集合。這個的結果，Relay 會使用新的變數來嘗試滿足新的 fragment。如果資料在客戶端還不能使用的話，這可能涉及傳送一個請求到伺服器。</p><p>可以選擇性的提供一個 <code>onReadyStateChange</code> callback 來回應關注資料滿足的事件。</p><h4><a class="anchor" name="setvariables"></a>範例 <a class="hash-link" href="#setvariables">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">Feed</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>viewer<span class="token punctuation">.</span>feed<span class="token punctuation">.</span>edges<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
          edge <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>Story story<span class="token operator">=</span><span class="token punctuation">{</span>edge<span class="token punctuation">.</span>node<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>edge<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">_handleScrollLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">// 把被 render 的 story 數量增加 10 個。</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>relay<span class="token punctuation">.</span><span class="token function">setVariables</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>relay<span class="token punctuation">.</span>variables<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>Feed<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  initialVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    viewer<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL`
      fragment on Viewer <span class="token punctuation">{</span>
        <span class="token function">feed</span><span class="token punctuation">(</span>first<span class="token punctuation">:</span> $count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          edges <span class="token punctuation">{</span>
            node <span class="token punctuation">{</span>
              id<span class="token punctuation">,</span>
              $<span class="token punctuation">{</span>Story<span class="token punctuation">.</span><span class="token function">getFragment</span><span class="token punctuation">(</span><span class="token string">&#x27;story&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    `<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:220px;"></div><div class="line-highlight" style="height:20px;top:240px;"></div><div class="line-highlight" style="height:20px;top:260px;"></div><div class="line-highlight" style="height:20px;top:280px;"></div></pre><blockquote><p>附註</p><p><code>setVariables</code> 不會立即變動 <code>variables</code>，但是會建立一個等待的 state transition。<code>variables</code> 會持續回傳先前的值，直到滿足新的變數值的資料填入了 <code>this.props</code>。</p></blockquote><p>也可以參閱：<a href="guides-containers.html#requesting-different-data" target="_blank">Containers &gt; 請求不同的資料</a>、<a href="guides-ready-state.html" target="_blank">Ready State</a>。</p><h3><a class="anchor" name="forcefetch"></a>forceFetch <a class="hash-link" href="#forcefetch">#</a></h3><pre class="prism language-javascript">
<span class="token function">forceFetch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>partialVariables<span class="token punctuation">:</span> Object<span class="token punctuation">,</span> <span class="token punctuation">[</span>onReadyStateChange<span class="token punctuation">:</span> Function<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span></pre><p><code>forceFetch</code> 類似於 <code>setVariables</code>，因為它也可以用來透過修改 <code>variables</code> 來改變資料需求。</p><p>這兩種方法不同的地方在，<code>forceFetch</code> 傳送一個請求來重新抓取每個 fragment，而不是傳送一個只包含客戶端缺少欄位的 query。這可以確保 component props 是剛從伺服器抓取回來的。</p><p>可以提供一個選擇性的 <code>onReadyStateChange</code> callback 來回應涉及資料滿足的事件。</p><blockquote><p>注意</p><p>可以用一組空的變數呼叫 <code>forceFetch</code>，這意味它可以觸發刷新當下被 render 的資料集。</p></blockquote><p>也可以參閱：<a href="guides-ready-state.html" target="_blank">Ready State</a></p><h3><a class="anchor" name="hasoptimisticupdate"></a>hasOptimisticUpdate <a class="hash-link" href="#hasoptimisticupdate">#</a></h3><pre class="prism language-javascript">
<span class="token function">hasOptimisticUpdate</span><span class="token punctuation">(</span>record<span class="token punctuation">:</span> Object<span class="token punctuation">)</span><span class="token punctuation">:</span> boolean</pre><p>用一個從 <code>this.props</code> 來的 record 呼叫 <code>hasOptimisticUpdate</code>，會回傳是否這個給定的 record 有受到 optimistic mutation 的影響。這讓 component 可以用不同的方式去 render 本地 optimistic 變更和成功與伺服器同步的資料。</p><h4><a class="anchor" name="hasoptimisticupdate"></a>範例 <a class="hash-link" href="#hasoptimisticupdate">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">Feed</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> edges <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>viewer<span class="token punctuation">.</span>feed<span class="token punctuation">.</span>edges<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>edges<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>edge <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> node <span class="token operator">=</span> edge<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>relay<span class="token punctuation">.</span><span class="token function">hasOptimisticUpdate</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span spellcheck="true" class="token comment">// 使用一個不同的 component 來 render</span>
            <span spellcheck="true" class="token comment">// 還沒被存到伺服器等待中的 story。</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>PendingStory
                key<span class="token operator">=</span><span class="token punctuation">{</span>edge<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
                story<span class="token operator">=</span><span class="token punctuation">{</span>edge<span class="token punctuation">.</span>node<span class="token punctuation">}</span>
              <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>Story
                key<span class="token operator">=</span><span class="token punctuation">{</span>edge<span class="token punctuation">.</span>node<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
                story<span class="token operator">=</span><span class="token punctuation">{</span>edge<span class="token punctuation">.</span>node<span class="token punctuation">}</span>
              <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>Feed<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  initialVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    viewer<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL`
      fragment on Viewer <span class="token punctuation">{</span>
        <span class="token function">feed</span><span class="token punctuation">(</span>first<span class="token punctuation">:</span> $count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          edges <span class="token punctuation">{</span>
            node <span class="token punctuation">{</span>
              id<span class="token punctuation">,</span>
              $<span class="token punctuation">{</span>Story<span class="token punctuation">.</span><span class="token function">getFragment</span><span class="token punctuation">(</span><span class="token string">&#x27;story&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
              $<span class="token punctuation">{</span>PendingStory<span class="token punctuation">.</span><span class="token function">getFragment</span><span class="token punctuation">(</span><span class="token string">&#x27;story&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    `<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>也可以參閱：<a href="guides-mutations.html#optimistic-updates" target="_blank">Mutations &gt; Optimistic 更新</a></p><h3><a class="anchor" name="getpendingtransactions"></a>getPendingTransactions <a class="hash-link" href="#getpendingtransactions">#</a></h3><pre class="prism language-javascript">
<span class="token function">getPendingTransactions</span><span class="token punctuation">(</span>record<span class="token punctuation">:</span> Object<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>RelayMutationTransaction<span class="token operator">&gt;</span></pre><p>Component 可以對任何的 record（例如：在 props 上可以取用的資料與一個對應的 fragment）檢查是否有等待中的 mutation。用 record 去呼叫 <code>getPendingTransactions</code> 將會回傳一個影響特定 record 的等待中 mutation transaction 列表。</p><p>每個 <code>RelayMutationTransaction</code> 有方法來檢查 mutation 的狀態並提供 rollback 的方式或根據需求重新傳送 mutation。</p><h4><a class="anchor" name="getpendingtransactions"></a>範例 <a class="hash-link" href="#getpendingtransactions">#</a></h4><pre class="prism language-javascript">
<span class="token keyword">class</span> <span class="token class-name">Story</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> story <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>story<span class="token punctuation">;</span>
    <span class="token keyword">var</span> transactions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>relay<span class="token punctuation">.</span><span class="token function">getPendingTransactions</span><span class="token punctuation">(</span>story<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span spellcheck="true" class="token comment">// 在這個範例，假設只有一個 transaction。</span>
    <span class="token keyword">var</span> transaction <span class="token operator">=</span> transactions <span class="token operator">?</span> transactions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>transaction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span spellcheck="true" class="token comment">// 如果 mutation 失敗，顯示一個錯誤訊息和重試的連結。</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>transaction<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#x27;COMMIT_FAILED&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>
            This story failed to post<span class="token punctuation">.</span>
            <span class="token operator">&lt;</span>a onClick<span class="token operator">=</span><span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>recommit<span class="token punctuation">}</span><span class="token operator">&gt;</span>Try Again<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span spellcheck="true" class="token comment">// 一般地 render story。</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>ProfilePicture<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    story<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`
      fragment on story {
        # ...
      }
    `</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p><code>RelayMutationTransaction.getStatus</code> 可以回傳以下其中一個字串：</p><ul><li><code>UNCOMMITTED</code> — Transaction 還沒被傳送到伺服器。Transaction 可以被 commit 或 rollback。</li><li><code>COMMIT_QUEUED</code> —  Transaction 已經被 commit，但是另一個具有相同衝突的 key 的 transaction 還在等待中，所以 transaction 已經被放入隊列等待傳送到伺服器。</li><li><code>COLLISION_COMMIT_FAILED</code> — Transaction 已經放入隊列等待 commit，但是另一個具有相同衝突 key 的 transaction 失敗了。所有在衝突的隊列中的 transaction，包含這個，都變成失敗。Transaction 可以重新被 commit 或 rollback。</li><li><code>COMMITTING</code> — Transaction 正在等待伺服器的回應。</li><li><code>COMMIT_FAILED</code> — Transaction 為了 commit 已經被送到伺服器，但是失敗了。</li></ul><h2><a class="anchor" name="static"></a>Static 方法 <a class="hash-link" href="#static">#</a></h2><h3><a class="anchor" name="getfragment"></a>getFragment <a class="hash-link" href="#getfragment">#</a></h3><pre class="prism language-javascript">
<span class="token function">getFragment</span><span class="token punctuation">(</span>
  fragmentName<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  variables<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> string<span class="token punctuation">]</span><span class="token punctuation">:</span> mixed<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span> RelayFragmentReference</pre><p>在 parent fragment 中取得一個包含 child container 的 fragment 的 reference。</p><h4><a class="anchor" name="getfragment"></a>範例 <a class="hash-link" href="#getfragment">#</a></h4><p>Fragment 合成可以透過 ES6 template string interpolation 和 <code>getFragment</code> 來達成：</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// Parent.js</span>
Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>Parent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    parentFragment<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL`
      fragment on Foo <span class="token punctuation">{</span>
        id
        $<span class="token punctuation">{</span>Child<span class="token punctuation">.</span><span class="token function">getFragment</span><span class="token punctuation">(</span><span class="token string">&#x27;childFragment&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    `<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span spellcheck="true" class="token comment">// Child.js</span>
Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>Child<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  initialVariables<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    size<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    childFragment<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL<span class="token template-string"><span class="token string">`
      fragment on Foo {
        photo(size: $size) { uri }
      }
    `</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:100px;"></div></pre><p>在這個範例中，無論 <code>Parent</code> 何時被抓取，<code>Child</code> 的 fragment 也會被抓取。在 render 時，<code>&lt;Parent&gt;</code> 將會只能存取 <code>props.foo.id</code> 欄位；從 child fragment 來的資料將會被<a href="http://facebook.github.io/relay/docs/thinking-in-relay.html#data-masking" target="_blank"><em>遮罩</em></a>。預設情況下，<code>childFragment</code> 會使用它對應的初始變數。Relay 將會抓取 <code>photo(size: 64)</code>。當 <code>&lt;Child&gt;</code> 被 render 後，它也會讓初始變數能以 <code>props.relay.variables = {size: 64}</code> 的方式取用。</p><h4><a class="anchor" name="getfragment-fragment"></a>覆寫 Fragment 變數 <a class="hash-link" href="#getfragment-fragment">#</a></h4><p>有時 parent 需要去覆寫 child component 的預設變數。試想，如果我們想要用 128 的 photo size 來取代預設的 64 去 render 上面的 <code>Child</code>。要做到這個，我們必須確保 fragment <em>和</em> container 都知道這個自訂的變數。要在 <em>query</em> 中設定自訂的變數，使用 <code>getFragment</code> 的第二個參數：</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// Parent.js</span>
Relay<span class="token punctuation">.</span><span class="token function">createContainer</span><span class="token punctuation">(</span>Parent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  fragments<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    parentFragment<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Relay<span class="token punctuation">.</span>QL`
      fragment on Foo <span class="token punctuation">{</span>
        id
        $<span class="token punctuation">{</span>Child<span class="token punctuation">.</span><span class="token function">getFragment</span><span class="token punctuation">(</span><span class="token string">&#x27;childFragment&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>size<span class="token punctuation">:</span> <span class="token number">128</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    `<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:100px;"></div></pre><p>現在 Relay 會用 size 128 去抓取 photo - 不過 <code>Child</code> container 不會自動地知道這個變數。我們必須透過傳遞這個變數值作為 prop 來告訴它：</p><pre class="prism language-javascript">
<span class="token keyword">const</span> Parent <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Child
      childFragment<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>parentFragment<span class="token punctuation">}</span>
      size<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">128</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><div class="line-highlight" style="height:20px;top:60px;"></div></pre><p>現在 Relay 會抓取大一點的 photo size <em>而且</em> <code>Child</code> 會知道要 render 它。</p></div><div class="docs-prevnext"><a class="docs-next" href="api-reference-relay-route.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">©2016 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
              ga('create', 'UA-71174216-1', 'auto');
              ga('send', 'pageview');
          </script></body></html>