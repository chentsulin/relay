<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Relay Compiler - Relay Docs</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Relay Compiler - Relay Docs"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/relay/"><meta property="og:description" content="A JavaScript framework for building data-driven React applications"><link rel="shortcut icon" href="/relay/img/favicon.png"><link rel="stylesheet" href="/relay/css/relay.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/relay/"><img class="nav-logo" src="/relay/img/logo.svg" width="50" height="50">Relay</a><ul class="nav-site"><li><a href="/relay/prototyping/playground.html" class="">Try it out</a></li><li><a href="/relay/docs/getting-started.html" class="active">Docs</a></li><li><a href="/relay/support.html" class="">Support</a></li><li><a href="https://github.com/facebook/relay" class="">GitHub</a></li></ul></div></div><section class="content wrap documentationContent"><div class="inner-content"><a id="content"></a><h1>Relay Compiler</h1><div><p>Relay Modern uses the Relay Compiler to convert <code>graphql</code> literals into generated
files that live alongside your source files.</p><p>While you type queries as:</p><pre class="prism language-javascript">
graphql<span class="token template-string"><span class="token string">`
  fragment MyComponent on Type {
    field
  }
`</span></span></pre><p>This causes a generated file to appear in <code>./__generated__/MyComponent.graphql</code>,
with both runtime artifacts (which help to read and write from the Relay Store)
and <a href="https://flow.org/" target="_blank">Flow types</a> to help you write type-safe code.</p><p>The Relay Compiler is responsible for generating code as part of a build step which, at runtime, can be used statically. By building the query ahead of time, the client&#x27;s JS runtime is not responsible for generating a query string, and fields that are duplicated in the query can be merged during the build step, to improve parsing efficiency. If you have the ability to persist queries to your server, the compiler&#x27;s code generation process provides a convenient time to convert a query or mutation&#x27;s text into a unique identifier, which greatly reduces the upload bytes required.</p><h2><a class="anchor" name="setting-up-relay-compiler"></a>Setting up Relay Compiler <a class="hash-link" href="#setting-up-relay-compiler">#</a></h2><p>First, you need <a href="https://facebook.github.io/watchman" target="_blank">watchman</a> installed:</p><pre class="prism language-javascript">
brew install watchman</pre><p>Next, install the compiler (typically as a <code>devDependency</code>):</p><pre class="prism language-javascript">
yarn add <span class="token operator">--</span>dev relay<span class="token operator">-</span>compiler</pre><p>This installs the bin script <code>relay-compiler</code> in your node_modules folder. It&#x27;s
recommended to run this from a yarn/npm script by adding a script to your
<code>package.json</code> file:</p><pre class="prism language-javascript">
<span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;relay&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;relay-compiler --src ./src --schema ./schema.graphql&quot;</span>
<span class="token punctuation">}</span></pre><p>The <code>relay-compiler</code> script requires both the directory which holds your source files as well as a path to your GraphQL schema in either a .json or .graphql schema file.</p><p>Then after making edits to your application files, just run <code>yarn run relay</code> to generate new files, or <code>yarn run relay -- --watch</code> to run the compiler as a long-lived process which automatically generates new files whenever you save.</p><h3><a class="anchor" name="optionally-install-globally"></a>Optionally install globally <a class="hash-link" href="#optionally-install-globally">#</a></h3><p>Alternatively, you can install <code>relay-compiler</code> globally so you can access it directly:</p><pre class="prism language-javascript">
yarn global add relay<span class="token operator">-</span>compiler</pre><p>Then after making edits to your application files, run <code>relay-compiler --src ./src --schema path/schema.graphql</code> to generate new files, or <code>relay-compiler --src ./src --schema path/schema.graphql --watch</code> to run the compiler as a long-lived process which automatically generates new files whenever you save.</p><h2><a class="anchor" name="graphql-schema"></a>GraphQL Schema <a class="hash-link" href="#graphql-schema">#</a></h2><p>To use the Relay Compiler, you need either a .graphql or .json GraphQL schema file, describing your GraphQL server&#x27;s API. Typically these files are local representations of a server source of truth and are not edited directly. For example, we might have a <code>schema.graphql</code> like:</p><pre class="prism language-javascript">
schema <span class="token punctuation">{</span>
  query<span class="token punctuation">:</span> Root
<span class="token punctuation">}</span>

type Root <span class="token punctuation">{</span>
  dictionary<span class="token punctuation">:</span> <span class="token punctuation">[</span>Word<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

type Word <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> String<span class="token operator">!</span>
  definition<span class="token punctuation">:</span> WordDefinition
<span class="token punctuation">}</span>

type WordDefinition <span class="token punctuation">{</span>
  text<span class="token punctuation">:</span> String
  image<span class="token punctuation">:</span> String
<span class="token punctuation">}</span></pre><h2><a class="anchor" name="source-files"></a>Source files <a class="hash-link" href="#source-files">#</a></h2><p>Additionally, you need a directory containing <code>.js</code> files that use the <code>graphql</code> tag to describe GraphQL queries and fragments. Let&#x27;s call this <code>./src</code>.</p><p>Then run <code>yarn run relay</code> as set up before.</p><p>This will create a series of <code>__generated__</code> directories that are co-located with the corresponding files containing <code>graphql</code> tags.</p><p>For example, given the two files:</p><ul><li><p><code>src/Components/DictionaryComponent.js</code></p><pre class="prism language-javascript">
<span class="token keyword">const</span> DictionaryWordFragment <span class="token operator">=</span> graphql<span class="token template-string"><span class="token string">`
  fragment DictionaryComponent_word on Word {
    id
    definition {
      ...DictionaryComponent_definition
    }
  }
`</span></span>

<span class="token keyword">const</span> DictionaryDefinitionFragment <span class="token operator">=</span> graphql<span class="token template-string"><span class="token string">`
  fragment DictionaryComponent_definition on WordDefinition {
    text
    image
  }
`</span></span></pre></li><li><p><code>src/Queries/DictionaryQuery.js</code></p><pre class="prism language-javascript">
<span class="token keyword">const</span> DictionaryQuery <span class="token operator">=</span> graphql<span class="token template-string"><span class="token string">`
  query DictionaryQuery {
    dictionary {
      ...DictionaryComponent_word
    }
  }
`</span></span></pre></li></ul><p>This would produce three generated files, and two <code>__generated__</code> directories:</p><ul><li><code>src/Components/__generated__/DictionaryComponent_word.graphql.js</code></li><li><code>src/Components/__generated__/DictionaryComponent_definition.graphql.js</code></li><li><code>src/Queries/__generated__/DictionaryQuery.graphql.js</code></li></ul><h2><a class="anchor" name="importing-generated-definitions"></a>Importing generated definitions <a class="hash-link" href="#importing-generated-definitions">#</a></h2><p>Typically you will not need to import your generated definitions. The <a href="./babel-plugin-relay.html" target="_blank">Relay Babel plugin</a> will convert the <code>graphql</code> literals to <code>require()</code> the generated files.</p><p>However the Relay Compiler also automatically generates flow types, as <a href="https://flow.org/en/docs/types/comments/" target="_blank">type comments</a>. To import the types:</p><pre class="prism language-javascript">
<span class="token keyword">import</span> type <span class="token punctuation">{</span>DictionaryComponent_word<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./__generated__/DictionaryComponent_word.graphql&#x27;</span><span class="token punctuation">;</span></pre><h2><a class="anchor" name="advanced-usage"></a>Advanced usage <a class="hash-link" href="#advanced-usage">#</a></h2><p>In addition to the bin script, the <code>relay-compiler</code> package also <a href="https://github.com/facebook/relay/blob/master/packages/relay-compiler/RelayCompilerPublic.js" target="_blank">exports library
code</a> which you may use to create more complex configurations for the compiler, or to extend the compiler with your own custom output.</p><p>If you find you need to do something unique (like generate types that conform to an older version of flow, or to parse non-javascript source files), you can build your own version of the Compiler by swapping in your own <code>FileWriter</code> and <code>FileParser</code>, or by adding on an additional <code>IRTransform</code>. Note, the internal APIs of the <code>RelayCompiler</code> are under constant iteration, so rolling your own version may lead to incompatibilities with future releases.</p></div><div class="docs-prevnext"><a class="docs-next" href="relay-debugging.html">Next →</a></div></div><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/getting-started.html">Getting Started</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/tutorial.html">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-graphql.html">Thinking in GraphQL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-relay.html">Thinking In Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/videos.html">Videos</a></li></ul></div><div class="nav-docs-section"><h3>Relay Modern</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/relay-modern.html">Introduction to Relay Modern</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/new-in-relay-modern.html">New in Relay Modern</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/relay-environment.html">The Relay &quot;Environment&quot;</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/network-layer.html">The Relay Network Layer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/query-renderer.html">QueryRenderer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/fragment-container.html">FragmentContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/refetch-container.html">RefetchContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/pagination-container.html">PaginationContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/routing.html">Routing</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/mutations.html">Mutations</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/subscriptions.html">Subscriptions</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/babel-plugin-relay.html">babel-plugin-relay</a></li><li><a style="margin-left:0;" class="active" href="/relay/docs/relay-compiler.html">Relay Compiler</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/relay-debugging.html">Debugging</a></li></ul></div><div class="nav-docs-section"><h3>Relay Compat</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/relay-compat.html">Compatibility Mode</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/conversion-playbook.html">Conversion Playbook</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/conversion-scripts.html">Conversion Scripts</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/upgrading-setvariables.html">Upgrading setVariables</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/compatibility-cheatsheet.html">Compatibility Cheatsheet</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-cheatsheet.html">API Cheatsheet</a></li></ul></div><div class="nav-docs-section"><h3>Relay Classic Guides</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/guides-containers.html">Containers</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-routes.html">Routes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-root-container.html">Root Container</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-ready-state.html">Ready State</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-mutations.html">Mutations</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-network-layer.html">Network Layer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-babel-plugin.html">Babel Relay Plugin</a></li></ul></div><div class="nav-docs-section"><h3>GraphQL</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-relay-specification.html">GraphQL Relay Specification</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-object-identification.html">Object Identification</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-connections.html">Connection</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-mutations.html">Mutations</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-further-reading.html">Further Reading</a></li></ul></div><div class="nav-docs-section"><h3>Relay Classic API</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay.html">Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-container.html">RelayContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-route.html">Relay.Route</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-renderer.html">Relay.Renderer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-root-container.html">Relay.RootContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-ql.html">Relay.QL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-mutation.html">Relay.Mutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-graphql-mutation.html">Relay.GraphQLMutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-proptypes.html">Relay.PropTypes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-store.html">Relay.Store</a></li></ul></div><div class="nav-docs-section"><h3>Relay Classic Interfaces</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-network-layer.html">RelayNetworkLayer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-mutation-request.html">RelayMutationRequest</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-query-request.html">RelayQueryRequest</a></li></ul></div></div></section><footer><span><a class="edit-page-link" href="https://github.com/facebook/relay/blob/master/docs/RelayCompiler.md" target="_blank">Edit This Page</a></span><span>Copyright © 2017 Facebook Inc</span></footer></div><div id="fb-root"></div><script>
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
              ga('create', 'UA-71174216-1', 'auto');
              ga('send', 'pageview');
          </script></body></html>